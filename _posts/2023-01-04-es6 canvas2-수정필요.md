---
title: ES6 Canvas2
tags: html javascript
--- 

Link: [ES6 Canvas][id]

[id]: https://ksg0000.github.io/2023/01/03/es6-canvas.html

Html
-------------

```html

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="item/boy.js"></script>
    <script src="panel/game-canvas.js"></script>
    <script src="app.js"></script>
</head>

<body>
    <canvas class="game-canvas" width="500" height="700"></canvas>
</body>

</html>

```

boy.js
-------------

```js

class Boy {

    constructor(x, y) {
        this.x = x || 100;
        this.y = y || 100;

        this.vx = 0; //벡터
        this.vy = 0;

        this.dx = 0;
        this.dy = 0;

        // 이미지를 그리기 위한 변수들
        this.ix = 0;
        this.iy = 2;

        // 수정 필요 X
        this.sw = 106;
        this.sh = 148.25;
        this.sx = this.sw * this.ix;
        this.sy = this.sh * this.iy;
    }

    draw(ctx) {
        let img = new Image();
        img.src = "./images/boy.png";

        img.onload = function () {
            ctx.drawImage(img, this.sx, this.sy, this.sw, this.sh,
                this.x, this.y, this.sw, this.sh);
        }.bind(this);
    }
    update() {
        this.x += this.vx;
        this.y += this.vy;
    }

    moveTo(dx, dy) {
        let w = dx - this.x;
        let h = dy - this.y;

        let d = Math.sqrt(w * w + h * h);

        this.vx = w / d;
        this.vy = h / d;
    }
    move(dir) {
        switch (dir) {
            case 1: // 북
                this.y -= 1;
                break;
            case 2: // 동
                this.x += 1;
                break;
            case 3: // 남
                this.y += 1;
                break;
            case 4: // 서
                this.x -= 1;
                break;
        }
    }
}

```

game-canvas.js
-------------

```js

class GameCanvas {

    constructor() {
        this.dom = document.querySelector(".game-canvas");

        /** @type {CanvasRenderingContext2D} */
        this.ctx = this.dom.getContext("2d");

        this.boy = new Boy(100, 100);

        this.gameover = false;
        // 게임이 끝났다는 건 내 캐릭터가 살아 있을 수 없다 적은 살아있다
        this.pause = false;
        // 애니메이션 멈추기
        // 변수명과 매서드명이 겹치면 안된다

        this.dom.onclick = this.clickHandler.bind(this);
    }

    run() {
        if (this.pause)
            return;

        this.update();
        this.draw();

        console.log('timer start');

        // window.setTimeout 3가지 방법 / 1회성 알람 / 1초는 1000

        // 1
        // window.setTimeout(this.run.bind(this), 1000);
        // run 앞 this는 GameCanvas.run()을 가르키기 위해 사용
        // setTimeout을 사용함으로써 호출자가 window로 바뀜가 run()을 호출하면서 호출자가 바뀌기 때문에 .bind(this)사용


        // 2
        // window.setTimeout(function () {
        //        this.run();
        // }.bind(this), 1000);

        // 3
        window.setTimeout(() => {
            this.run();
        }, 17)
        // 자기 영역(지역화)가 없다

        // window.setInterval / 매일 알람
    }
    update() {
        this.boy.update();
        // this.boy.move(2);
    }
    draw() {
        this.boy.draw(this.ctx);
    }
    pause(){
        this.pause = true;
    }

    // -----event handlers-----

    clickHandler(event) {
        this.boy.moveTo(event.x, event.y);
        // this.boy.move(2);
    }

}

```

app.js
-------------

```js

window.addEventListener("load", function () {

    const gameCanvas = new GameCanvas();

    gameCanvas.run();

    // gameCanvas.pause();
})

```


